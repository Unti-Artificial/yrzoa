<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yrz.oa.core.dao.ClockDao">
    <!-- 打卡 -->
    <insert id="ClockIn" parameterType="Clock">
      insert  into oa_clock(
      ClockUser,
      ClockCreateTime
      ) values (
      #{ClockUser},
      #{ClockCreateTime}
      )
    </insert>
    <!-- 迟到打卡 -->
    <insert id="ClockOver" parameterType="ClockTime">
      insert  into oa_clock_over(
      ClockUser,
      ClockOverCreateTime
      ) values (
      #{ClockUser},
      #{ClockOverCreateTime}
      )
    </insert>
    <insert id="ClockInTime" parameterType="ClockOverTime">
      insert into oa_clock_time(
           ClockUserName,
           ClockInDegree,
           ClockInCreateTime
         ) values (
           #{ClockUserName},
           #{ClockInDegree},
           #{ClockInCreateTime}
         )
     </insert>
    <!--如果迟到，则添加到迟到表里 -->
    <insert id="ClockOverTime" parameterType="ClockOverTime">
      insert into oa_clock_overtime(
           ClockUserName,
           ClockOverDegree,
           ClockOverCreateTime
         ) values (
           #{ClockUserName},
           #{ClockOverDegree},
           #{ClockOverCreateTime}
         )
     </insert>
    <!-- 查询是否今日已经打过卡 -->
    <select id="selectDegree" resultType="Integer" parameterType="String">
        select sum(ClockInDegree)
        from oa_clock_time
        where ClockInCreateTime = #{present}
        and ClockUserName = #{userName}
      </select>
    <!--查询迟到打卡次数 -->
    <select id="selectOverDegree" resultType="Integer" parameterType="String">
          select sum(ClockOverDegree)
          from oa_clock_overtime
          where ClockOverCreateTime = #{present}
          and ClockUserName = #{userName}
    </select>
    <!-- 根据用户名和每月日期查询当月打卡总数-->
    <select id="selectTotalByNameAndDate" parameterType="String" resultType="Integer">
       select sum(ClockIndegree)
       from oa_clock_time
       where ClockUserName = #{username}
       and ClockInCreateTime > #{date}
    </select>
    <!--根据用户名和每月日期查询当月迟到打卡总数 -->
    <select id="selectTotalOverByNameAndDate" parameterType="String" resultType="Integer">
       select sum(ClockOverDegree)
       from oa_clock_overtime
       where ClockUserName = #{username}
       and ClockOverCreateTime > #{date}
    </select>
    <!-- 提示当天是否打卡 -->
     <select id="selectIfOrNotClock" parameterType="String" resultType="Integer">
      select *
      from oa_clock_today
      where todayDegree = 1
      and  clockCreateTime = #{today}
     </select>
    <!--添加至天表 -->
    <insert id="ClockToday" parameterType="ClockToday">
      insert into oa_clock_today(
       clockCreateTime,
       todayDegree,
       userName
      ) values (
        #{clockCreateTime},
        #{todayDegree},
        #{userName}
      )

    </insert>
</mapper>